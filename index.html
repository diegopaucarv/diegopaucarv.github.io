<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diego Paucar - CV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #000000;
            --background: #ffffff;
            --text: #1a1a1a;
            --text-light: #666666;
            --border: #e0e0e0;
            --accent-work: #2196F3;
            --accent-design: #FF6B6B;
            --accent-edu: #4CAF50;
            --accent-other: #FFC107;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        /* Combined header with lang toggle and config */
        .header-controls {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 1000;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .language-toggle {
            display: flex;
            gap: 0.25rem;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.25rem;
        }

        .lang-btn {
            padding: 0.5rem 0.75rem;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.3s ease;
            border-radius: 3px;
        }

        .lang-btn.active {
            background: var(--primary);
            color: var(--background);
        }

        /* Config button */
        .btn-config {
            padding: 0.5rem 0.75rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .btn-config:hover {
            background: var(--primary);
            color: var(--background);
        }

        /* Login modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--background);
            border-radius: 8px;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .modal h2 {
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .modal-form input {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 1rem;
        }

        .modal-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn-primary, .btn-secondary {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--background);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: var(--border);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .modal-error {
            color: #d32f2f;
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        /* HEADER */
        .header {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 2rem;
            padding: 3rem 2rem;
            max-width: 1000px;
            margin: 0 auto;
            border-bottom: 1px solid var(--border);
            align-items: start;
        }

        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 6px;
            object-fit: cover;
            border: 2px solid var(--primary);
            background: var(--border);
        }

        .header-content h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header-subtitle {
            font-size: 0.8rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .header-professions {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 0.75rem;
            font-weight: 500;
        }

        .header-description {
            font-size: 0.95rem;
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .btn-print {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            background: var(--primary);
            color: var(--background);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-print:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        /* TIMELINE */
        .timeline-section {
            max-width: 1000px;
            margin: 3rem auto;
            padding: 0 2rem;
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 2rem;
            text-align: center;
        }

        .timeline {
            position: relative;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            height: 100%;
            background: var(--border);
            top: 0;
        }

        .timeline-item {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            margin-bottom: 2.5rem;
            align-items: flex-start;
            opacity: 0;
            animation: slideIn 0.5s ease forwards;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .timeline-item:nth-child(1) { animation-delay: 0.1s; }
        .timeline-item:nth-child(2) { animation-delay: 0.15s; }
        .timeline-item:nth-child(3) { animation-delay: 0.2s; }
        .timeline-item:nth-child(4) { animation-delay: 0.25s; }
        .timeline-item:nth-child(5) { animation-delay: 0.3s; }

        .timeline-content {
            font-size: 0.95rem;
        }

        .timeline-content.left {
            text-align: right;
        }

        .timeline-content.right {
            text-align: left;
        }

        .timeline-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .timeline-year {
            font-size: 0.8rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 600;
            order: 2;
        }

        /* Square bullet integrated with title */
        .timeline-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .timeline-content.left .timeline-header {
            flex-direction: row-reverse;
        }

        .timeline-bullet {
            width: 14px;
            height: 14px;
            border-radius: 2px;
            background: var(--primary);
            flex-shrink: 0;
        }

        .timeline-bullet.work { background: var(--accent-work); }
        .timeline-bullet.design { background: var(--accent-design); }
        .timeline-bullet.education { background: var(--accent-edu); }
        .timeline-bullet.other { background: var(--accent-other); }

        .timeline-item h3 {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--text);
        }

        .timeline-role {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .timeline-description {
            color: var(--text-light);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-top: 0.5rem;
        }

        /* INFO CARDS */
        .info-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            max-width: 1000px;
            margin: 3rem auto;
            padding: 0 2rem;
        }

        .info-card {
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: #fafafa;
        }

        .info-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary);
        }

        .info-item {
            margin-bottom: 1.25rem;
            position: relative; /* For delete button positioning */
        }

        .info-item:last-child {
            margin-bottom: 0;
        }

        .info-item h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .info-item p {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .info-item a {
            color: var(--primary);
            text-decoration: none;
        }

        .info-item a:hover {
            text-decoration: underline;
        }

        /* SKILLS */
        .skills-section {
            max-width: 1000px;
            margin: 3rem auto;
            padding: 0 2rem;
        }

        .skills-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .skill-tag {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: #f0f0f0;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* FOOTER */
        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
            font-size: 0.9rem;
            border-top: 1px solid var(--border);
            margin-top: 3rem;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .timeline::before {
                left: 20px;
            }

            .timeline-item {
                grid-template-columns: auto 1fr;
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .timeline-center {
                position: absolute;
                left: 0;
                top: 0;
            }

            .timeline-content {
                margin-left: 40px;
                text-align: left !important;
            }

            .timeline-content .timeline-header {
                flex-direction: row !important;
            }

            .timeline-content.left .timeline-header {
                flex-direction: row !important;
            }

            .header {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .profile-image {
                width: 80px;
                height: 80px;
            }

            .header-content h1 {
                font-size: 1.8rem;
            }

            .section-title {
                font-size: 1.4rem;
            }

            .header-controls {
                top: 1rem;
                right: 1rem;
                gap: 0.5rem;
            }

            .language-toggle {
                gap: 0.1rem;
            }

            .info-section {
                grid-template-columns: 1fr;
            }
        }

        /* PRINT STYLES */
        @media print {
            .header-controls,
            .btn-print,
            .btn-add,
            .btn-delete {
                display: none !important;
            }

            body {
                background: white;
            }

            .header {
                border-bottom: 2px solid var(--primary);
            }
        }

        /* Language content visibility */
        .lang-content {
            display: none;
        }

        .lang-content.active {
            display: block;
        }

        /* Add edit mode styles for inline editing and CRUD operations */
        .editable-field {
            cursor: pointer;
            position: relative;
        }

        .editable-field:hover {
            background: rgba(0, 0, 0, 0.02);
            border-radius: 2px;
        }

        .editable-field.edit-mode {
            background: #fffef0;
            padding: 0.5rem;
            border-radius: 3px;
            border: 2px solid var(--primary);
        }

        .editable-field input,
        .editable-field textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--primary);
            border-radius: 3px;
            font-family: inherit;
            font-size: inherit;
        }

        .edit-controls {
            display: none;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .edit-controls.active {
            display: flex;
        }

        .btn-delete {
            padding: 0.4rem 0.8rem;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.85rem;
            opacity: 0;
            transition: opacity 0.2s ease;
            position: absolute; /* Position delete button */
            top: 0.5rem;
            right: 0.5rem;
        }

        .timeline-item:hover .btn-delete,
        .info-item:hover .btn-delete {
            opacity: 1;
        }

        .btn-delete:hover {
            background: #b71c1c;
        }

        .btn-add {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .btn-add:hover {
            background: #333;
        }

        /* Create modal styles */
        .create-modal {
            max-width: 600px;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <!-- Header controls with lang toggle and config -->
    <div class="header-controls">
        <div class="language-toggle">
            <button class="lang-btn active" data-lang="en" onclick="UI.changeLanguage('en')">EN</button>
            <button class="lang-btn" data-lang="es" onclick="UI.changeLanguage('es')">ES</button>
        </div>
        <button class="btn-config" onclick="UI.toggleLoginModal()" id="configBtn">âš™ Config</button>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <h2 id="modalTitle">Login</h2>
            <form class="modal-form" onsubmit="Auth.handleLogin(event)">
                <input type="email" id="emailInput" placeholder="Email" required>
                <input type="password" id="passwordInput" placeholder="Password" required>
                <div id="modalError" class="modal-error"></div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-primary" id="submitBtn">Login</button>
                    <button type="button" class="btn-secondary" onclick="UI.toggleLoginModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <img id="profileImage" src="/placeholder.svg?height=100&width=100" alt="Profile" class="profile-image">
        <div class="header-content">
            <p class="header-subtitle">
                <span class="lang-content active" data-lang="en">Hello, my name is</span>
                <span class="lang-content" data-lang="es">Hola, mi nombre es</span>
            </p>
            
            <h1 id="personName">Diego Paucar</h1>
            
            <p class="header-professions" id="professions">Full Stack Developer</p>
            
            <p class="header-description" id="description">Passionate about building elegant and functional digital experiences.</p>
            
            <button class="btn-print" onclick="window.print()">
                <span>ðŸ“„</span>
                <span class="lang-content active" data-lang="en">Print Resume</span>
                <span class="lang-content" data-lang="es">Imprimir CV</span>
            </button>
        </div>
    </div>

    <!-- Timeline Section -->
    <div class="timeline-section">
        <h2 class="section-title">
            <span class="lang-content active" data-lang="en">Experience</span>
            <span class="lang-content" data-lang="es">Experiencia</span>
        </h2>
        
        <div class="timeline" id="timelineContainer">
            <!-- Timeline items populated by JavaScript -->
        </div>
        <!-- Add create button for experience -->
        <button class="btn-add" id="addExpBtn" style="display: none;" onclick="CRUD.openCreateModal('experiencia')">+ Add Experience</button>
    </div>

    <!-- Education & Links -->
    <div class="info-section" id="infoSection">
        <!-- Populated by JavaScript -->
    </div>

    <!-- Skills Section -->
    <div class="skills-section" id="skillsSection">
        <!-- Populated by JavaScript -->
    </div>

    <!-- Add create modal for generic CRUD operations -->
    <div class="modal-overlay" id="createModal">
        <div class="modal create-modal">
            <h2 id="createModalTitle">Create New Entry</h2>
            <form class="modal-form" id="createForm" onsubmit="CRUD.handleCreateSubmit(event)">
                <div id="formFieldsContainer"></div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-primary" id="createSubmitBtn">Create</button>
                    <button type="button" class="btn-secondary" onclick="CRUD.closeCreateModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p class="lang-content active" data-lang="en">Â© 2026 Diego Paucar. All rights reserved.</p>
        <p class="lang-content" data-lang="es">Â© 2026 Diego Paucar. Todos los derechos reservados.</p>
    </div>

    <script>
        const App = {
            cvData: null,
            currentLanguage: localStorage.getItem('language') || 'en',
            isLoggedIn: localStorage.getItem('sessionToken') ? true : false,
            credentials: null
        };

        const Auth = {
            async init() {
                try {
                    const response = await fetch('./config.json');
                    if (response.ok) {
                        App.credentials = await response.json();
                    } else {
                        console.warn('Config file not found. Proceeding without auth.');
                    }
                } catch (error) {
                    console.warn('Could not load credentials:', error);
                }
            },
            
            handleLogin(event) {
                event.preventDefault();
                const email = document.getElementById('emailInput').value;
                const password = document.getElementById('passwordInput').value;
                const errorDiv = document.getElementById('modalError');
                errorDiv.textContent = '';

                if (!App.credentials) {
                    errorDiv.textContent = 'Authentication not configured.';
                    return;
                }

                const validUser = App.credentials.users?.find(u => u.email === email && u.password === password);
                
                if (validUser) {
                    const sessionToken = btoa(`${email}:${Date.now()}`);
                    localStorage.setItem('sessionToken', sessionToken);
                    App.isLoggedIn = true;
                    UI.updateConfigButton();
                    UI.toggleLoginModal();
                    alert('Logged in successfully!');
                    document.getElementById('emailInput').value = '';
                    document.getElementById('passwordInput').value = '';
                    Render.renderCV(); // Re-render to show admin controls
                } else {
                    errorDiv.textContent = 'Invalid email or password.';
                }
            },

            logout() {
                localStorage.removeItem('sessionToken');
                App.isLoggedIn = false;
                UI.updateConfigButton();
                Render.renderCV(); // Re-render to hide admin controls
            }
        };

        const UI = {
            changeLanguage(lang) {
                App.currentLanguage = lang;
                localStorage.setItem('language', lang);

                // Update lang buttons
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.lang === lang);
                });

                // Update lang content
                document.querySelectorAll('.lang-content').forEach(el => {
                    el.classList.toggle('active', el.dataset.lang === lang);
                });
                Render.renderCV();
            },

            toggleLoginModal() {
                const modal = document.getElementById('loginModal');
                modal.classList.toggle('active');
            },

            updateConfigButton() {
                const btn = document.getElementById('configBtn');
                if (App.isLoggedIn) {
                    btn.textContent = 'ðŸ”“ Logout';
                    btn.onclick = () => {
                        Auth.logout();
                        UI.updateConfigButton();
                    };
                } else {
                    btn.textContent = 'âš™ Config';
                    btn.onclick = () => UI.toggleLoginModal();
                }
            }
        };

The reason your experience and skills sections are appearing empty is a mapping misalignment.

In your JSON, your data arrays have fewer items than the tables schema defines columns. Specifically, your mapping logic columns[index + 1] assumes the language tag is at a specific index that your data doesn't reach.
Why it's failing:

    For Experience: Your schema has 14 columns, but your data row only has 12 items. Your current logic maps the final "en" to referencia_linkedin instead of lengua.

    For Skills: Your schema has 12 columns, but your data row only has 8 items. The "en" tag is being mapped to certificate_year.

    The Result: When the filter runs (item.lengua === App.currentLanguage), it finds undefined instead of "en", so it removes every item from the list.

The Solution: Updated mapAndFilter

Replace your Data object with this version. It identifies the language tag by looking at the last item in each data array, which is consistent across your entire JSON file.
JavaScript

const Data = {
    async fetchCVData() {
        try {
            const response = await fetch('./cvs.json');
            if (!response.ok) throw new Error('Network response was not ok');
            const fullJson = await response.json();
            
            const rawData = fullJson.data;
            const schema = fullJson.tables;

            // Find the personal data row matching current language
            const personalRow = rawData.datos_personales.find(row => row[row.length - 1] === App.currentLanguage) 
                               || rawData.datos_personales[0];

            App.cvData = {
                nombres: personalRow[1], 
                perfil: personalRow[5],
                foto_url: "/profile.jpg", 
                
                profesiones: this.mapAndFilter(rawData.profesiones, schema, 'profesiones'),
                experiencia: this.mapAndFilter(rawData.experiencia, schema, 'experiencia'),
                educacion: this.mapAndFilter(rawData.educacion, schema, 'educacion'),
                enlaces_personales: this.mapAndFilter(rawData.enlaces_personales, schema, 'enlaces_personales'),
                skills: this.mapAndFilter(rawData.skills, schema, 'skills')
            };

            Render.renderCV();
        } catch (error) {
            console.error('Parsing error:', error);
            this.loadMockData();
        }
    },

    mapAndFilter(dataArray, schema, tableName) {
        const tableSchema = schema.find(t => t.name === tableName);
        if (!tableSchema) return [];
        const columns = tableSchema.columns.map(col => col.name);
        
        return dataArray
            .map(row => {
                let obj = {};
                // Capture the language from the LAST element of the array
                const rowLanguage = row[row.length - 1];
                
                row.forEach((value, index) => {
                    const columnName = columns[index + 1]; 
                    if (columnName) obj[columnName] = value;
                });

                // Force the language property to the actual value found
                obj.lengua = rowLanguage; 
                return obj;
            })
            // Filter strictly by the current language
            .filter(item => item.lengua === App.currentLanguage);
    }
};

        const Render = {
            renderCV() {
                if (!App.cvData) return;

                let desc_es = "SociÃ³logo y cientÃ­fico de datos neurodivergente y amado por Dios. Me defino como un agente de cambio. Disfruto simplificando problemas complejos, automatizando la investigaciÃ³n social y haciendo la vida mÃ¡s fÃ¡cil para quienes me rodean, empezando por mÃ­ mismo."
                let desc_en = "Neurodivergent and God-loved sociologist and data scientist. I define myself as a change agent. I enjoy simplifying hard problems, automatizing social research and making life easier to others around me, starting by myself." 
                
                document.getElementById('personName').textContent = "Diego Paucar"
                document.getElementById('professions').textContent = App.cvData.profesiones?.map(p => p.profesion).join(' | ') || '';
                document.getElementById('description').textContent = (App.currentLanguage === "es") ? desc_es : desc_en;
                
                if (App.cvData.foto_url) {
                    document.getElementById('profileImage').src = App.cvData.foto_url;
                }

                this.renderTimeline();
                this.renderInfoSections();
                this.renderSkills();

                // Show/hide admin controls based on login status
                document.getElementById('addExpBtn').style.display = App.isLoggedIn ? 'inline-block' : 'none';
            },

            renderTimeline() {
                const container = document.getElementById('timelineContainer');
                container.innerHTML = '';
                console.log(App.cvData)
                if (!App.cvData.experiencia || App.cvData.experiencia.length === 0) {
                    container.innerHTML = '<p class="lang-content active" data-lang="en">No experience available.</p><p class="lang-content" data-lang="es">No hay experiencia disponible.</p>';
                    return;
                }

                const sorted = [...App.cvData.experiencia].sort((a, b) => {
                    const dateA = new Date(a.inicio_anio === 'Actual' ? Date.now() : a.inicio_anio);
                    const dateB = new Date(b.inicio_anio === 'Actual' ? Date.now() : b.inicio_anio);
                    return dateB - dateA;
                });

                sorted.forEach((exp, index) => {
                    const isLeft = index % 2 === 0;
                    const year = this.formatYear(exp.inicio_anio, exp.fin_anio);
                    const categoryClass = this.getCategoryClass(exp.profesion_id);

                    const item = document.createElement('div');
                    item.className = 'timeline-item';
                    
                    const contentClass = isLeft ? 'left' : 'right';
                    const emptyDiv = isLeft ? '' : `<div></div>`;
                    const bulletDiv = `
                        <div class="timeline-center">
                            <div class="timeline-bullet ${categoryClass}"></div>
                            <p class="timeline-year">${year}</p>
                        </div>
                    `;
                    <!-- Add delete button and edit capability to timeline items -->
                    const deleteBtn = App.isLoggedIn ? `<button class="btn-delete" onclick="CRUD.deleteExperience(${exp.id})">Delete</button>` : '';
                    const contentDiv = `
                        <div class="timeline-content ${contentClass}">
                            <div class="timeline-header">
                                <div class="timeline-bullet ${categoryClass}"></div>
                                <h3 class="editable-field" ondblclick="CRUD.makeEditable(this, 'text')">${exp.institucion}</h3>
                            </div>
                            <p class="timeline-role editable-field" ondblclick="CRUD.makeEditable(this, 'text')">${exp.rol}</p>
                            <p class="timeline-description editable-field" ondblclick="CRUD.makeEditable(this, 'textarea')">${exp.tareas}</p>
                            ${deleteBtn}
                        </div>
                    `;

                    if (isLeft) {
                        item.innerHTML = `${contentDiv}${bulletDiv}${emptyDiv}`;
                    } else {
                        item.innerHTML = `${emptyDiv}${bulletDiv}${contentDiv}`;
                    }

                    container.appendChild(item);
                });
                
                <!-- Show add button when logged in -->
                const addBtn = document.getElementById('addExpBtn');
                if (addBtn) addBtn.style.display = App.isLoggedIn ? 'inline-block' : 'none';
            },

            getCategoryClass(profId) {
                const map = { 1: 'work', 2: 'design', 3: 'education' }; // Assuming profession IDs map to categories
                return map[profId] || 'other';
            },

            renderInfoSections() {
                const container = document.getElementById('infoSection');
                container.innerHTML = '';
            
                // Filter education by language
                const filteredEdu = App.cvData.educacion.filter(edu => edu.lengua === App.currentLanguage);
                if (filteredEdu.length > 0) {
                    const eduCard = document.createElement('div');
                    eduCard.className = 'info-card';
                    <!-- Add delete buttons and edit capability to education items -->
                    const eduItems = filteredEdu.map(edu => {
                        const deleteBtn = App.isLoggedIn ? `<button class="btn-delete" onclick="CRUD.deleteEducation(${edu.id})">Delete</button>` : '';
                        return `
                            <div class="info-item">
                                <h4 class="editable-field" ondblclick="CRUD.makeEditable(this, 'text')">${edu.titulo}</h4>
                                <p class="editable-field" ondblclick="CRUD.makeEditable(this, 'text')">${edu.institucion}</p>
                                <p>${edu.fecha_inicio ? new Date(edu.fecha_inicio).getFullYear() : 'Year unknown'}</p>
                                ${deleteBtn}
                            </div>
                        `;
                    }).join('');
                    
                    eduCard.innerHTML = `
                        <h3>
                            <span class="lang-content active" data-lang="en">Education</span>
                            <span class="lang-content" data-lang="es">EducaciÃ³n</span>
                        </h3>
                        ${eduItems}
                        ${App.isLoggedIn ? '<button class="btn-add" onclick="CRUD.openCreateModal(\'educacion\')">+ Add Education</button>' : ''}
                    `;
                    container.appendChild(eduCard);
                }

                if (App.cvData.enlaces_personales && App.cvData.enlaces_personales.length > 0) {
                    const linksCard = document.createElement('div');
                    linksCard.className = 'info-card';
                    <!-- Add delete buttons to links -->
                    const linkItems = App.cvData.enlaces_personales.map(link => {
                        const deleteBtn = App.isLoggedIn ? `<button class="btn-delete" onclick="CRUD.deleteLink(${link.id})">Delete</button>` : '';
                        return `
                            <div class="info-item">
                                <h4><a href="${link.url}" target="_blank" rel="noopener noreferrer">${link.tipo}</a></h4>
                                ${deleteBtn}
                            </div>
                        `;
                    }).join('');
                    
                    linksCard.innerHTML = `
                        <h3>
                            <span class="lang-content active" data-lang="en">Links</span>
                            <span class="lang-content" data-lang="es">Enlaces</span>
                        </h3>
                        ${linkItems}
                        ${App.isLoggedIn ? '<button class="btn-add" onclick="CRUD.openCreateModal(\'enlaces_personales\')">+ Add Link</button>' : ''}
                    `;
                    container.appendChild(linksCard);
                }
            },

            renderSkills() {
                const container = document.getElementById('skillsSection');
                if (!App.cvData.skills || App.cvData.skills.length === 0) {
                    container.style.display = 'none';
                    return;
                }

                container.innerHTML = `
                    <h2 class="section-title">
                        <span class="lang-content active" data-lang="en">Skills</span>
                        <span class="lang-content" data-lang="es">Habilidades</span>
                    </h2>
                    <div class="skills-grid">
                        ${App.cvData.skills.map(skill => `
                            <span class="skill-tag">${skill.skill_name}</span>
                        `).join('')}
                    </div>
                `;
            },

            formatYear(start, end) {
                const startDate = new Date(start);
                const startYear = isNaN(startDate) ? start : startDate.getFullYear();
                
                let endYear;
                if (end === 'Actual') {
                    endYear = 'Present';
                } else {
                    const endDate = new Date(end);
                    endYear = isNaN(endDate) ? end : endDate.getFullYear();
                }
                
                return `${startYear}`;
            }
        };

        <!-- Add CRUD operations module for edit/delete/create functionality -->
        const CRUD = {
            currentEditElement: null,
            currentEditField: null,

            makeEditable(element, fieldType) {
                if (!App.isLoggedIn) return;

                // Prevent making nested elements editable
                if (element.querySelector('.edit-controls')) return;

                const originalContent = element.innerHTML; // Keep HTML for nested tags like <a>
                const inputType = fieldType === 'textarea' ? 'textarea' : 'input';
                const input = document.createElement(inputType);
                
                // Extract plain text for input value
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = originalContent;
                input.value = tempDiv.textContent.trim(); // Use textContent to get plain text

                input.className = `editable-${fieldType}`;

                element.innerHTML = '';
                element.appendChild(input);
                element.classList.add('edit-mode');

                const saveBtn = document.createElement('button');
                saveBtn.textContent = 'Save';
                saveBtn.type = 'button';
                saveBtn.className = 'btn-primary';
                saveBtn.style.marginRight = '0.5rem';
                saveBtn.onclick = (e) => {
                    e.preventDefault();
                    CRUD.saveEdit(element, input.value, originalContent, fieldType);
                };

                const cancelBtn = document.createElement('button');
                cancelBtn.textContent = 'Cancel';
                cancelBtn.type = 'button';
                cancelBtn.className = 'btn-secondary';
                cancelBtn.onclick = (e) => {
                    e.preventDefault();
                    CRUD.cancelEdit(element, originalContent);
                };

                const controls = document.createElement('div');
                controls.className = 'edit-controls active';
                controls.appendChild(saveBtn);
                controls.appendChild(cancelBtn);

                element.appendChild(controls);
                input.focus();

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && fieldType === 'text') {
                        e.preventDefault(); // Prevent default Enter behavior for text input
                        CRUD.saveEdit(element, input.value, originalContent, fieldType);
                    }
                    if (e.key === 'Escape') {
                        e.preventDefault();
                        CRUD.cancelEdit(element, originalContent);
                    }
                });
            },

            saveEdit(element, newValue, originalHtml, fieldType) {
                element.classList.remove('edit-mode');
                
                // Reconstruct the element with saved value, preserving original structure if possible
                if (fieldType === 'textarea') {
                    element.innerHTML = newValue;
                } else {
                    // For text, try to preserve original HTML structure if it was more than just text
                    if (originalHtml.includes('<')) {
                        // Simple heuristic: if original had HTML, assume it was intended.
                        // More robust would be to parse and update specific elements.
                        // For now, replace the text content of the editable element.
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = originalHtml;
                        const editablePart = tempDiv.querySelector('.editable-field'); // Find the exact editable part if nested
                        if (editablePart) {
                           editablePart.textContent = newValue; // Replace only the text
                           element.innerHTML = tempDiv.innerHTML;
                        } else {
                           // Fallback if structure not recognized, just set the new value
                           element.textContent = newValue;
                        }
                    } else {
                        element.textContent = newValue;
                    }
                }
                
                // For simplicity, this example doesn't sync back to App.cvData or GitHub.
                // In a real app, you'd find the ID of the item and update the corresponding field in App.cvData.
                // e.g., update CVData(element, newValue);
                
                const controls = element.querySelector('.edit-controls');
                if(controls) controls.remove();

                // Re-apply event listener if needed, or structure might prevent it
                if (element.parentElement.classList.contains('timeline-item')) {
                    // Timeline item, re-render might be complex. For now, assume it works.
                } else if (element.parentElement.classList.contains('info-item')) {
                    // Info item
                }
            },

            cancelEdit(element, originalHtml) {
                element.classList.remove('edit-mode');
                element.innerHTML = originalHtml;
                const controls = element.querySelector('.edit-controls');
                if(controls) controls.remove();
            },

            deleteExperience(id) {
                if (!confirm('Delete this experience?')) return;
                App.cvData.experiencia = App.cvData.experiencia.filter(e => e.id !== id);
                Render.renderTimeline();
            },

            deleteEducation(id) {
                if (!confirm('Delete this education?')) return;
                App.cvData.educacion = App.cvData.educacion.filter(e => e.id !== id);
                Render.renderInfoSections();
            },

            deleteLink(id) {
                if (!confirm('Delete this link?')) return;
                App.cvData.enlaces_personales = App.cvData.enlaces_personales.filter(e => e.id !== id);
                Render.renderInfoSections();
            },

            openCreateModal(tableName) {
                const modal = document.getElementById('createModal');
                const title = document.getElementById('createModalTitle');
                const container = document.getElementById('formFieldsContainer');

                const schema = this.getTableSchema(tableName);
                title.textContent = `Add New ${tableName.charAt(0).toUpperCase() + tableName.slice(1)}`; // Capitalize table name
                container.innerHTML = '';

                Object.entries(schema).forEach(([fieldName, fieldType]) => {
                    const group = document.createElement('div');
                    group.className = 'form-group';
                    
                    const label = document.createElement('label');
                    label.textContent = fieldName.replace(/_/g, ' ').toUpperCase();
                    
                    let input;
                    if (fieldType === 'textarea') {
                        input = document.createElement('textarea');
                    } else {
                        input = document.createElement('input');
                        input.type = fieldType === 'date' ? 'date' : 'text';
                    }
                    input.id = `field-${fieldName}`;
                    input.dataset.field = fieldName;
                    input.required = true; // Assume most fields are required

                    group.appendChild(label);
                    group.appendChild(input);
                    container.appendChild(group);
                });

                modal.classList.add('active');
                document.getElementById('createForm').dataset.table = tableName;
                
                // Focus first input
                const firstInput = container.querySelector('input, textarea');
                if (firstInput) firstInput.focus();
            },

            closeCreateModal() {
                const modal = document.getElementById('createModal');
                modal.classList.remove('active');
                document.getElementById('createForm').reset(); // Reset form on close
                document.getElementById('formFieldsContainer').innerHTML = ''; // Clear fields
            },

            handleCreateSubmit(event) {
                event.preventDefault();
                const form = document.getElementById('createForm');
                const tableName = form.dataset.table;
                const newEntry = {};

                // Basic validation for required fields
                let allFieldsValid = true;
                form.querySelectorAll('[data-field]').forEach(input => {
                    if (input.required && !input.value.trim()) {
                        allFieldsValid = false;
                        input.style.borderColor = 'red'; // Highlight invalid field
                    } else {
                        input.style.borderColor = ''; // Reset border color
                        newEntry[input.dataset.field] = input.value;
                    }
                });

                if (!allFieldsValid) {
                    alert('Please fill in all required fields.');
                    return;
                }

                // Generate a simple unique ID
                const currentEntries = App.cvData[tableName] || [];
                const maxId = Math.max(0, ...currentEntries.map(e => e.id || 0));
                newEntry.id = maxId + 1;

                // Add the new entry to the corresponding array in App.cvData
                if (App.cvData[tableName]) {
                    App.cvData[tableName].push(newEntry);
                } else {
                    // If the array doesn't exist, create it
                    App.cvData[tableName] = [newEntry];
                }

                // Re-render the relevant section
                if (tableName === 'experiencia') {
                    Render.renderTimeline();
                } else if (tableName === 'educacion' || tableName === 'enlaces_personales') {
                    Render.renderInfoSections();
                }
                // Potentially add rendering for other sections if more tables are added

                CRUD.closeCreateModal();
                form.reset();
            },

            getTableSchema(tableName) {
                // Define the schema for each table that can be created
                const schemas = {
                    experiencia: {
                        institucion: 'text',
                        rol: 'text',
                        inicio_anio: 'date',
                        fin_anio: 'date',
                        tareas: 'textarea'
                    },
                    educacion: {
                        titulo: 'text',
                        institucion: 'text',
                        fecha_inicio: 'date'
                    },
                    enlaces_personales: {
                        tipo: 'text',
                        url: 'text'
                    }
                };
                return schemas[tableName] || {};
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            UI.changeLanguage(App.currentLanguage);
            UI.updateConfigButton();
            Auth.init().then(() => Data.fetchCVData());
        });

        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('loginModal');
            const createModal = document.getElementById('createModal');
            if (modal.classList.contains('active')) {
                if (e.key === 'Escape') {
                    UI.toggleLoginModal();
                }
            }
            if (createModal.classList.contains('active')) {
                if (e.key === 'Escape') {
                    CRUD.closeCreateModal();
                }
            }
        });
    </script>
</body>
</html>
